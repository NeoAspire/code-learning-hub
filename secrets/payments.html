<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pay to Download PDF</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f9;
      margin: 0;
      padding: 15px;
      /* mobile spacing */
    }

    /* FORM STYLES */
    form {
      background: transparent;
      /* remove white box */
      padding: 0;
      border-radius: 0;
      max-width: 100%;
      margin: 0;
      box-shadow: none;
    }

    form label {
      margin-top: 14px;
      font-size: 16px;
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }

    form input,
    form select,
    form button {
      width: 100%;
      width: 100%;
      padding: 12px;
      margin-top: 6px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 16px;
      box-sizing: border-box;
    }

    select {
      background-color: #fff;
      cursor: pointer;
    }

    small {
      font-size: 12px;
      color: #666;
    }

    button {
      background: #E64A19;
      color: white;
      border: none;
      font-size: 16px;
      margin-top: 15px;
      cursor: pointer;
    }

    button:hover {
      background: #FF5F1F;
    }

    /* PAYMENT BOX STYLES */
    .payment-box,
    form {
      width: 100%;
      max-width: 520px;
      /* desktop width */
    }

    .payment-box {
      width: 100%;
      max-width: 520px;
      /* desktop width */
      margin: 30px auto;
      background: #fff;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      text-align: center;
    }


    .payment-box h1 {
      margin-bottom: 10px;
      color: #222;
    }

    .payment-box p {
      color: #555;
      font-size: 14px;
    }

    .qr {
      width: 220px;
      margin: 20px auto;
      border-radius: 10px;
      border: 1px solid #ddd;
    }

    /* PRICE DETAILS */
    .price-card {
      background: linear-gradient(135deg, #eef6ff, #ffffff);
      border: 1px solid #d6e8ff;
      border-radius: 14px;
      padding: 18px 15px;
      margin: 20px 0;
      text-align: center;
    }

    .price {
      font-size: 34px;
      font-weight: bold;
      color: #0d6efd;
      margin-bottom: 4px;
    }

    .price-note {
      font-size: 13px;
      color: #444;
      margin-top: 4px;
    }

    .important {
      margin-top: 15px;
      font-weight: bold;
      color: #333;
    }

    .note {
      font-size: 12px;
      color: #777;
      margin-top: 8px;
    }

    /* RESPONSIVE STYLES */
    @media (max-width: 480px) {
      .payment-box {
        padding: 18px;
      }

      form {
        padding: 18px;
      }

      .price {
        font-size: 24px;
      }

      button {
        font-size: 1px;
      }
    }
  </style>
</head>

<body>

  <div class="payment-box">
    <h1>Pay to Download PDF</h1>
    <p>Scan the QR code using any UPI app and complete the payment.</p>

    <img src="images/your-upi-qr.png" alt="UPI QR Code" class="qr">

    <!-- PRICE DETAILS -->

    <div class="price-card">
      <div class="price">‚Çπ99</div>
      <div class="price-note"><strong>Per Subject</strong></div>

      <div class="price-note">‚úî Separate payment for each subject</div>
      <div class="price-note">‚è≥ 3 months view-only access</div>
      <div class="price-note">üö´ Print & download disabled</div>
    </div>


    <!-- PAYMENT DETAILS FORM -->

    <form id="myForm" method="POST" enctype="multipart/form-data">

      <!-- FormSubmit settings -->
      <input type="hidden" name="_subject" value="PDF Payment Verification">
      <input type="hidden" name="_captcha" value="false">
      <input type="hidden" name="_template" value="table">

      <label>Your Name</label>
      <input type="text" name="name" placeholder="Enter your name" required>

      <label>Email Address</label>
      <input type="email" name="email" placeholder="Enter your email" required>

      <label>Select Class</label>
      <select name="class" id="classSelect" required>
        <option value="">Select Your Class</option>
        <option value="Class 9">Class 9</option>
        <option value="Class 10">Class 10</option>
      </select>

      <label>Select Subject</label>
      <select name="subject" id="subjectSelect" required disabled>
        <option value="">Select Subject</option>
      </select>

      <label>Select Chapter</label>
      <select name="chapter" id="chapterSelect" required disabled>
        <option value="">Select Chapter</option>
      </select>

      <!-- ‚úÖ Amount Paid BEFORE UTR -->
      <label>Amount Paid (‚Çπ)</label>
      <select name="amount_paid" id="amountSelect" required>
        <option value="">Select Amount</option>
        <option value="‚Çπ99">‚Çπ99</option>
        <option value="‚Çπ199">‚Çπ199</option>
      </select>
      <small>Enter the exact amount you paid</small>

      <label>UPI Transaction ID (UTR)</label>
      <input type="text" name="utr" placeholder="Example: 325487XXXX" required pattern="[A-Za-z0-9]{8,20}">
      <small>UTR is available in your payment app</small>

      <label>Payment Screenshot (Optional)</label>
      <input type="file" name="screenshot" accept=".jpg,.jpeg,.png">
      <small>Upload only if available. Max size: 5 MB</small>

      <button type="submit">Submit Payment Details</button>

    </form>

    <!-- JavaScript + Google Apps Script Link Form Submission -->
    <script>
      const scriptURL =
        'https://script.google.com/macros/s/AKfycbxT7q-kz95bnMY24tBcyRTBLrYXDOODtcbvacnG6xBdxwIYKPraC4gw9JMoL9Fe1bLWfw/exec';

      const form = document.getElementById('myForm');

      form.addEventListener('submit', e => {
        e.preventDefault();
        const button = form.querySelector('button');
        button.disabled = true;
        button.textContent = 'Submitting...';

        const fileInput = form.querySelector('input[name="screenshot"]');
        const file = fileInput.files[0];

        const MAX_SIZE = 5 * 1024 * 1024; // 5 MB

        // ‚ùå File too large2
        if (file && file.size > MAX_SIZE) {
          alert("‚ùå Screenshot size must not exceed 5 MB.");
          button.disabled = false;
          button.textContent = 'Submit Payment Details';
          return;
        }

        // ‚úÖ If file exists and size is OK
        if (file) {
          const reader = new FileReader();
          reader.onload = function () {
            const base64Data = reader.result.split(',')[1];
            sendData(base64Data, file.name, file.type);
          };
          reader.readAsDataURL(file);
        }
        // ‚úÖ If no file uploaded
        else {
          sendData(null, null, null);
        }
      });

      function sendData(base64, fileName, mimeType) {
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());

        // Add file data to the object
        data.fileData = base64;
        data.fileName = fileName;
        data.mimeType = mimeType;

        fetch(scriptURL, {
          method: 'POST',
          body: JSON.stringify(data) // Send as JSON string
        })

          .then(res => res.json())
          .then(response => {
            if (response.status === 'success') {
              alert(
                'Success! Data submitted.\n' +
                'You will receive the PDF link via email after verification.'
              );

              // Redirect AFTER user clicks OK
              form.reset();
              window.location.href = "qbank.html";

            }
            else {
              alert('Error: ' + response.message);
            }
          })

          .catch(error => console.error('Error!', error.message))
          .finally(() => {
            const button = form.querySelector('button');
            button.disabled = false;
            button.textContent = 'Submit Payment Details';
          });
      }
    </script>

    <!-- DEPENDENT DROPDOWNS SCRIPT -->
    <script>
      const dataMap = {
        "Class 9": {
          "Maths": ["All Chapters"],
          "Science": ["All Chapters"],
          "IT (402)": ["Employability Skills PART A", "Subject Speciifc Skills PART B"]
        },
        "Class 10": {
          "Maths": ["All Chapters"],
          "Science": ["All Chapters"],
          // "Ch-1 Chemical Reactions and Equations", "Ch-2 Acids, Bases and Salts", "Ch-3 Metals and Non-Metals",
          // "Ch-4 Carbon and its Compounds", "Ch-5 Life Processes", "Ch-6 Control and Coordination",
          // "Ch-7 How to do Organisms Reproduce?", "Ch-8 Heredity", "Ch-9 Light Reflection and Refraction",
          // "Ch-10 The Human Eye and The Colourful World", "Ch-11 Electricity", "Ch-12 Magnetic Effects of Electric Current",
          // "Ch-13 Our Environment"],
          "IT (402)": ["Employability Skills PART A", "Subject Speciifc Skills PART B"]
        }
      };

      const classSelect = document.getElementById("classSelect");
      const subjectSelect = document.getElementById("subjectSelect");
      const chapterSelect = document.getElementById("chapterSelect");

      classSelect.addEventListener("change", () => {
        subjectSelect.innerHTML = '<option value="">Select Subject</option>';
        chapterSelect.innerHTML = '<option value="">Select Chapter</option>';
        subjectSelect.disabled = false;
        chapterSelect.disabled = true;

        const selectedClass = classSelect.value;
        if (!selectedClass) return;

        Object.keys(dataMap[selectedClass]).forEach(subject => {
          subjectSelect.add(new Option(subject, subject));
        });
      });

      subjectSelect.addEventListener("change", () => {
        chapterSelect.innerHTML = '<option value="">Select Chapter</option>';
        chapterSelect.disabled = false;

        const chapters = dataMap[classSelect.value][subjectSelect.value];
        chapters.forEach(ch => chapterSelect.add(new Option(ch, ch)));
      });
    </script>

</body>

</html>